
<<<<<<< HEAD
#map_canvas {
  width: 100%;
}

.km-modalview .km-scroll-container {
    padding: 15px;
}

.km-scroll-container i.km-icon {
  display: inline-block;
}

.button-container {
  margin-top: 15px;
  text-align: center;
}
</style>
    <script type="text/javascript">
    var App = {
  mobile: null,
  map: null,
  geoLocation: {
    position: null,
    marker: null,
    timer: null,
    error: false
  },

  initMap: function (e) {
     this.mobile = new kendo.mobile.Application(document.body, {
      layout: 'default',
      initial: 'map'
    });
    var me = App;
    var element = document.getElementById('map_canvas');
    var options = {
      center: new google.maps.LatLng(36.9759254, -121.9533386),
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoom: 8
    };

    //CREATE MAP AND SAVE TO APP FOR LATER USE
    me.map = new google.maps.Map(element, options);

    //OPEN MODAL INSTRUCTIONS
    $('#map-modal').getKendoMobileModalView().open();
  },

  //USE TO CLOSE ANY MODAL
  onCloseModalClick: function (e) {
    //GET MODAL
    var modal = e.target
    .closest('.km-modalview')
    .getKendoMobileModalView();

    //CLOSE MODAL
    modal.close();
  },

  onSetGeoLocationClick: function (e) {
    var me = App;
    me.setGeoLocation(true);
  },

  //TRACKS THE DEVICE GEO LOCATION
  //http://diveintohtml5.info/geolocation.html
  //http://www.bennadel.com/blog/2023-Geocoding-A-User-s-Location-Using-Javascript-s-GeoLocation-API.htm
  setGeoLocation: function (watchPosition, fnCallback) {
    var me = this;

    var options = {
      timeout: (5 * 1000), //5 seconds
      maximumAge: (1000 * 60 * 15), //15 mins
      enableHighAccuracy: true
    };

    var success = function (position) {
      //PROCESS CALLBACK IF APPLICABLE
      if (fnCallback) fnCallback(position ? {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      } : null);

      //RESET ERROR FLAG
      me.geoLocation.error = false;

      //VALIDATE POSITION
      if (!position) {
        me.geoLocation.position = null;
        me.geoLocation.marker.setVisible(false);
        return;
      }

      //DECLARE VARIABLES
      var latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

      //UPDATE GEO POSITION
      me.geoLocation.position = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      //HANDLE NEW GEO MARKER FIRST TIME
      if (!me.geoLocation.marker) {
        //ADD GEO MARKER
        me.geoLocation.marker = new google.maps.Marker({
          position: latLng,
          map: me.map,
          animation: google.maps.Animation.DROP

        });
      } else {
        //UPDATE POSITION IF APPLICABLE
        me.geoLocation.marker.setMap(me.map);
        me.geoLocation.marker.setPosition(latLng);
        me.geoLocation.marker.setVisible(true);
      }

      me.map.setCenter(latLng);
    };

    var error = function (err) {
      //HANDLE ERROR
      switch (err.code) {
        case err.PERMISSION_DENIED:
          //NOTIFY USER OF NEW ERROR
          if (!me.geoLocation.error)
            //OPEN MODAL INSTRUCTIONS
            $('#geolocation-error-modal').getKendoMobileModalView().open();
          break;
        case err.POSITION_UNAVAILABLE:
          //NOTIFY USER OF NEW ERROR
          if (!me.geoLocation.error)
            //OPEN MODAL INSTRUCTIONS
            $('#geolocation-error-modal').getKendoMobileModalView().open();
          break;
        case err.TIMEOUT:
          break;
        case err.UNKNOWN_ERROR:
          break;
      }

      //SET ERROR FLAG
      me.geoLocation.error = true;
    };

    //HANDLE GEO LOCATION IF APPLICABLE
    if (navigator.geolocation) {
      //REQUEST INITIAL GEO LOCATION
      navigator.geolocation.getCurrentPosition(success, error, options);

      //WATCH FOR PHYSICAL MOVEMENT
      //SAVE TIMER FOR STOPPING LATER IF NEEDED
      if (watchPosition) me.geoLocation.timer = navigator.geolocation.watchPosition(success, error);
    }
  },

  getGeoLocation: function (fnCallback) {
    this.setGeoLocation(false, fnCallback);
  }
};

//INITAILIZE APP
App.initMap();
</script>
</head>
<body>  

  <div data-role="layout" data-id="default">
    <div data-role="header">
      <div data-role="navbar">
        <span data-role="view-title"></span>
      </div>
    </div>

    <div data-role="footer">
      <div data-role="tabstrip">
       
        <a href="#map" data-icon="globe">Map</a>
      </div>
    </div>
  </div>

 

  <div id="map" data-role="view"
    data-title="Map"
    data-stretch="true"
    data-init="App.initMap">
    <div data-role="header">
      <div data-role="navbar">
        <span data-role="view-title"></span>
        <a data-role="button"
          data-click="App.onSetGeoLocationClick"
          data-align="right"
          data-icon="home">
        </a>
      </div>
    </div>
    <div id="map_canvas"></div>
  </div>

  <div id="map-modal" data-role="modalview" style="width: 95%; height: 18em;"
    data-title="Getting Started">
    <div data-role="header">
      <div data-role="navbar">
        <span data-role="view-title"></span>
      </div>
    </div>
    The <i class="km-icon km-home"></i> home button in the top right will get your current geolocation when clicked.
    <div class="button-container">
      <a data-role="button"
        data-click="App.onCloseModalClick"
        data-icon="action">
        OK, got it!
      </a>
    </div>
  </div>

  <div id="geolocation-error-modal" data-role="modalview" style="width: 95%; height: 18em;"
    data-title="Geolocation Error">
=======
    <div data-role="view" id="mapview1" data-title="MAP" data-layout="default">
>>>>>>> parent of 0591b24... map view.hml
    <div data-role="header">
            <div style="color:black;" data-role="navbar">
                
                <a style="color:black;" class="nav-button nav-button-back hide-text" data-align="left" data-role="backbutton" href="#welcome">Back</a>
                <ul id="btnStoreViewToggle" data-role="buttongroup" data-index="0" data-align="center">
                <li>Map</li>
                <li>List</li>
            </ul>
            </div>
        </div>
 
         <div class="wrapper">
            <div id="map-canvas" style="width: 1300px; height: 600px"></div>
            <input id="btn-show" type="button" value="Show" />
        </div>
 
        </script>
          <!-- footer -->
               <div data-role="footer">
                            <!-- tabstrip -->
                    <div data-role="tabstrip">
                      <a style="color:black;" href="index.html" data-icon="search">Home</a>
                      <a style="color:black;" href="views/Post-Option-Sreen.html"><i style="color:black;" class="fa fa-map-marker fa-3x"></i><br/>Post</a>
                      <a style="color:black;" href="views/map.html"><i style="color:black;" class="fa fa-location-arrow fa-3x"></i><br/>Near Me</a>
                      <a style="color:black;" href="views/Favorite-Screen.html"><i style="color:black;" class="fa fa-star-o fa-3x"></i><br/>favorite</a>
                      <a style="color:black;" href="views/Refine-Search.html" data-icon="settings">Setting</a>
                 </div>
               </div>
                 <script>
            $(document).ready(function () {
                var everlive = new Everlive({
                    apiKey: "IMregDJC77R1b1yM",
                    scheme: "http"
                });
           
                var geocoder, map;
                function initialize() {
                    geocoder = new google.maps.Geocoder();
                    var latlng = new google.maps.LatLng(42.45, 23.20); 
                    var mapOptions = {
                        zoom: 2,
                        center: latlng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };

                    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
                    placeMarker(latlng, map, "You are here")
                }

                function getGeoData() {
                    var currentLocation = new Everlive.GeoPoint(23.379068, 42.650601); //longitude // latitude
                    var distance = 5000; // experiment with 5000, 15000, 25000
                    var metricUnit = "km";

                    var query = new Everlive.Query();
                    query.where().nearSphere('Location', currentLocation, distance, metricUnit);

                    var data = everlive.data('Posts');
                    return data.get(query);
                }
  
                function transformGeoDataToMarkers() {
                    getGeoData().then(
                        function (data) {
                            for (var i = 0; i < data.result.length; i++) {
                                var latitude = data.result[i].Location.latitude;
                                var longitude = data.result[i].Location.longitude;
                                //var townName = data.result[i].Name;

                                var coord = new google.maps.LatLng(latitude, longitude);
                                //var title = "Name: " + townName;
                                placeMarker(coord, map);
                            }
                        },
                        function (error) {
                            alert(JSON.stringify(error));
                        });
                }
            
                function placeMarker(coord, map) {
                    new google.maps.Marker({
                            position: coord,
                            map: map
                           
                        });
                }
            
                // bind events
                google.maps.event.addDomListener(window, 'load', initialize);
                var button = $("#btn-show");
                button.on('click', transformGeoDataToMarkers);
            });
        </script>
   </div>
   
       
     

    
